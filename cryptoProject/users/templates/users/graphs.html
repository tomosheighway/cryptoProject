{% extends 'users/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container" style="width: 50%; height: 50%;">
    <h1>Bitcoin Price Chart</h1>
    <!-- <h2>{{ user.username }}</h2> -->
    <canvas id="bitcoin-chart"></canvas>
</div>

<div class="container" style="width: 50%; height: 50%;">
    <h1>Ethereum Price Chart</h1>
    <canvas id="ethereum-chart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.1.1/dist/chartjs-plugin-zoom.min.js"></script>
<script>
var btc_ctx = document.getElementById('bitcoin-chart').getContext('2d');
var eth_ctx = document.getElementById('ethereum-chart').getContext('2d');
// const data = JSON.parse('{{ bitcoin_data|escapejs }}');


var btc_chart = new Chart(btc_ctx, {
    type: 'line',
    data: {
        datasets: [{
            label: 'Bitcoin Price (GBP)',
            data:[],
            borderColor: 'blue',
            borderWidth: 1, 
            pointRadius: 0,
            fill: false
        }]
    },
    options: {
        plugins: {
            legend: {
                display: false
            },
            tooltip: {
                enabled: true 
            }
        },
        scales: {
            x: {
                title: {
                    display: true,
                    text: 'Time'
                }
            },
            y: {
                title: {
                    display: true,
                    text: 'Price (£)'
                }
            }
        }
    }  
});

var eth_chart = new Chart(eth_ctx, {
    type: 'line',
    data: {
        datasets: [{
            label: 'Ethereum Price (GBP)',
            data:[],
            borderColor: 'blue',
            borderWidth: 1, 
            pointRadius: 0,
            fill: false
        }]
    },
    options: {
        plugins: {
            legend: {
                display: false
            },
            tooltip: {
                enabled: true 
            }
        },
        scales: {
            x: {
                title: {
                    display: true,
                    text: 'Time'
                }
            },
            y: {
                title: {
                    display: true,
                    text: 'Price (£)'
                }
            }
        }
    }  
});

function fetch_btc_data() {
    fetch('/bitcoin-chart/')
    .then(response => response.json())
    .then(data => {
        btc_chart.data.datasets[0].data = data.data;
        btc_chart.update();
    });
}

function fetch_eth_data() {
    fetch('/ethereum-chart/')
    .then(response => response.json())
    .then(data => {
        eth_chart.data.datasets[0].data = data.data;
        eth_chart.update();
    });
}
fetch_btc_data(); 
fetch_eth_data();  
setInterval(fetch_btc_data, 3600000);   
setInterval(fetch_eth_data, 3600000);    // updates every hour at the moment but data only daily , (60000)=  minute 
</script>
{% endblock %}
