{% extends 'users/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
    <div class="container">
        <h2>Hello {{user.username}}</h2>
        <h3>Add wallet address and select currency name to add a new holding to your portfolio</h3>
        <form method="post" action="{% url 'portfolio' %}">
            {% csrf_token %}
            <label for="wallet_address">Wallet Address:</label>
            <input type="text" id="wallet_address" name="wallet_address" pattern="^(bc1|[13]|0x)[a-zA-HJ-NP-Z0-9]{25,}$" title="Please enter a valid Bitcoin or Ethereum address" required>
            <br>
            <label for="currency_name">Currency Name:</label>
            <select id="currency_name" name="currency_name" required>
                <option value="">Select a currency...</option>
                <option value="btc">Bitcoin</option>
                <option value="eth">Ethereum</option>
                <!-- <option value="Litecoin">Litecoin</option> -->
            </select>
            <br>  
            <button type="submit">Add</button>    
        </form>

        <h2>Your Portfolio</h2>
        
        {% if portfolios %}

        <table>
          <tr>
            <th>Currency</th>
            <th>Address</th>
            <th>Balance</th>
            <th>Value</th>
            <th>Delete</th>
          </tr>
                {% for portfolio in portfolios %}
                    {% if portfolio.currency == 'btc' %}
                    <tr>
                        <td>{{ portfolio.currency|upper}}</td>
                        <td>{{ portfolio.address }}</td>
                        <td>{{ portfolio.balance }} BTC</td>
                        <td>£{{ portfolio.value|floatformat:2 }}</td>
                        <td><a href="{% url 'delete_portfolio' pk=portfolio.pk %}">X</a></td>
                    </tr>
                    {% elif portfolio.currency == 'eth' %}
                    <tr>
                        <td>{{ portfolio.currency|upper }}</td>
                        <td>{{ portfolio.address }}</td>
                        <td>{{ portfolio.balance }} ETH</td>
                        <td>£{{ portfolio.value|floatformat:2 }}</td>
                        <td><a href="{% url 'delete_portfolio' pk=portfolio.pk %}">X</a></td>
                    </tr>
                    {% else %}
                    <tr>
                        <td>{{ portfolio.currency|upper }}</td>
                        <td>{{ portfolio.address }}</td>
                        <td colspan="3">{{ portfolio.currency }} is not supported.</td>
                    </tr>
                    {% endif %}
                {% endfor %}
          <tr>
            <td colspan="3"></td>
            <td style="text-align: right;">Total: £ {{total_value|floatformat:2}}</td>
            <td></td>
          </tr>
        </table>
      {% else %}
        <p>You don't have any portfolios yet.</p>
      {% endif %}


        <style>
            table {
            border-collapse: collapse;
            width: 100%;
            }
        
            th, td {
            text-align: left;
            padding: 8px;
            border: 1px solid #ddd;
            }
        
            th {
            background-color: #f2f2f2;
            }
        
            tr:nth-child(even) {
            background-color: #f2f2f2;
            }
        </style>
    </div>
{% endblock %}

